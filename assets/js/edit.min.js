/*!
 * @package Restrict User Access
 * @author Joachim Jensen <joachim@dev.institute>
 * @license GPLv3
 * @copyright 2020 by Joachim Jensen
 */
!function($){"use strict";var e={current_section:0,sections:[],init:function(){this.suggestUsers(),this.suggestPages(),this.actionRoleHandler(),this.tabController(),this.capController()},suggestPages:function(){var t=$(".js-rua-page"),e=t.data("rua-url");t.select2({theme:"wpca",minimumInputLength:0,closeOnSelect:!0,allowClear:!1,width:"250px",ajax:{delay:400,url:ajaxurl,data:function(t){return{search:t.term||"",action:"rua/page/suggest",paged:t.page||1}},dataType:"JSON",type:"POST",processResults:function(t,e){return{results:t,pagination:{more:!(t.length<20)}}}},createTag:function(t){t=$.trim(t.term.replace(e,""));return""===t?null:("/"!==t[0]&&(t="/"+t),-1===t.indexOf(".")&&"/"!==t[t.length-1]&&(t+="/"),{id:t,text:t,new:!0})},templateResult:function(t){return t.new?$("<i>"+e+"</i><b>"+t.text+"</b>"):t.text},language:{noResults:function(){return e},inputTooShort:function(){return"Search for pages or enter custom link"}}})},suggestUsers:function(){var e=$("#post_ID").val();$(".js-rua-user-suggest").select2({theme:"wpca",cachedResults:{},quietMillis:400,searchTimer:null,post_id:e,placeholder:"Search for Users...",minimumInputLength:1,closeOnSelect:!1,allowClear:!1,width:"250px",ajax:{delay:400,url:ajaxurl,data:function(t){return{q:t.term||"",action:"rua/user/suggest",post_id:e}},dataType:"JSON",type:"POST",processResults:function(t){for(var e=[],n=t.length-1;0<=n;n--)e.push({id:t[n].ID,text:t[n].user_login+" ("+t[n].user_email+")"});return{results:e}}},nextSearchTerm:function(t,e){return e},language:{noResults:function(){return WPCA.noResults},searching:function(){return WPCA.searching+"..."}}})},actionRoleHandler:function(){var n=$("#rua-members");n.on("change",".js-rua-role",function(t){var e=""===$(this).val();n.find(".js-rua-members").toggle(e),$(".js-rua-drip-option").toggle(e),$(".duration").toggle(e)}),n.find(".js-rua-role").trigger("change")},initTabSections:function(){$(".js-rua-tabs").find(".nav-tab").each(function(){var t=this.href.lastIndexOf("#");0<=t&&(t=this.href.substr(t),e.sections.push(t),$(t).hide())})},tabController:function(){this.initTabSections(),this.setCurrentSection(window.location.hash),$("#poststuff").on("click",".js-nav-link",function(t){e.setCurrentSection(this.href)})},findSectionByURL:function(t){t=this.sections.indexOf(t.substring(t.lastIndexOf("#")));return 0<=t?t:null},setCurrentSection:function(t){var e=this.findSectionByURL(t)||0,t=$(".js-rua-tabs").find(".nav-tab");t.eq(e).is(":visible")&&($(this.sections[this.current_section]).hide(),t.eq(this.current_section).removeClass("nav-tab-active"),this.current_section=e,$(this.sections[this.current_section]).show(),t.eq(this.current_section).addClass("nav-tab-active"),$("#_rua_section").val("#top"+this.sections[this.current_section]))},capController:function(){function r(t){t.sum.text(t.checkboxes.filter(":checked").length)}var t,i=[{value:0,sum:$(".sum-0").first(),checkboxes:$(".column-deny").find("input.rua-cb")},{value:1,sum:$(".sum-1").first(),checkboxes:$(".column-permit").find("input.rua-cb")},{value:-1,sum:$(".sum--1").first(),checkboxes:$(".column-unset").find("input.rua-cb")}],e=$("input.js-rua-cb-all");for(t in i)r(i[t]);$("input.js-rua-cb-all").on("change",function(){var t,e=$(this),n=e.prop("checked"),s=e.val();for(t in i)i[t].checkboxes.prop("checked",i[t].value==s?n:!n),r(i[t])}),$("td input.rua-cb").on("change",function(){for(var t in i)r(i[t]);e.prop("checked",!1)})}};$(document).ready(function(){e.init()})}(jQuery);